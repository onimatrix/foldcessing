# Foldcessing

A lightweight preprocessor for Processing sketches that enables organizing source files in subdirectories.

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Platform](https://img.shields.io/badge/platform-Windows-lightgrey.svg)]()

## Overview

Processing requires all `.pde` files to be in a single flat directory. **Foldcessing** lets you organize your code in subdirectories and automatically concatenates them for compilation.

### Key Features

- **Subdirectory Support** - Organize `.pde` files in nested folders
- **Automatic Line Translation** - Error messages map back to original source files
- **16-bit Line Wrapping** - Handles Java's line number limitation for large projects (>65K lines)
- **IDE Integration** - Works seamlessly with Sublime Text, VS Code, and others
- **Profile System** - Multiple users can share the same project with different paths
- **Zero Dependencies** - Single, small executable. No installation required

## How It Works

1. Recursively scans your project for `.pde` files
2. Concatenates them alphabetically (depth-first) into `output/output.pde`
3. Builds a line mapping table for error translation
4. Launches `processing-java` and translates error messages in real-time

## Installation

### Pre-compiled Binary

Download `foldcessing.exe` from [Releases](../../releases) and place it in your sketch folder.

### Build from Source

See [BUILD](./BUILD.md)

## Usage

### Basic Usage

**Concatenate only:**
```bash
foldcessing.exe
```

**Run sketch:**
```bash
foldcessing.exe "C:\path\to\processing-java" --run
```

**Other Processing commands:**
```bash
foldcessing.exe "C:\path\to\processing-java" --present
foldcessing.exe "C:\path\to\processing-java" --export
```

### Configuration File

Create a `.foldcessing` file in your project root for automatic configuration:

```ini
[general]
# Ignore patterns (comma-separated, supports wildcards)
ignore=*.backup.pde,temp/,build/

# Default processing-java path
processing_path=C:\processing-3.4\processing-java

# Default action when running foldcessing with no arguments
default_action=--run

[profile:john]
processing_path=C:\Users\john\processing\processing-java

[profile:mary]
processing_path=/opt/processing/processing-java
```

**With config file:**
```bash
foldcessing.exe
foldcessing.exe --profile john
```

**Double-click to run** (requires `processing_path` and `default_action` in [general]):

### Profile System

Profiles allow multiple developers to work on the same project with different `processing-java` paths. Each developer can use their own profile without modifying the shared config:

```bash
foldcessing.exe --profile mary --run
```

## IDE Integration

### Sublime Text

Add to your `.sublime-project` file:

```json
{
    "build_systems": [
        {
            "name": "Processing with Foldcessing",
            "shell_cmd": "foldcessing.exe --run",
            "file_regex": "^(..[^:]*):([0-9]+):?([0-9]+)?:? (.*)$",
            "working_dir": "${project_path}",
            "selector": "source.pde"
        }
    ]
}
```

The `file_regex` enables clickable error messages that jump to the correct file and line.

### VS Code

Add to `.vscode/tasks.json`:

```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Run Processing Sketch",
            "type": "shell",
            "command": "foldcessing.exe",
            "args": ["--run"],
            "problemMatcher": []
        }
    ]
}
```

## Project Structure Example

```
my_sketch/
├── foldcessing.exe
├── .foldcessing              # Optional config file
├── src/
│   ├── core/
│   │   ├── setup.pde
│   │   └── draw.pde
│   └── utils/
│       ├── helpers.pde
│       └── colors.pde
└── output/                   # Generated by Foldcessing
    └── output.pde
```

## Line Number Translation

### Standard Translation

Error messages like `output.pde:142` are automatically translated to `src/core/setup.pde:25`.

### Large Project Handling (>65K lines)

Java's class file format stores line numbers as 16-bit unsigned integers (0-65535). For projects exceeding 65,536 lines, Java reports `actual_line % 65536`.

**Foldcessing handles this by:**
1. Trying all possible wrapped line numbers: `N`, `N+65536`, `N+131072`, etc.
2. Checking which fall within valid file ranges
3. Reporting results:
   - **Single match**: Reports confidently (e.g., `src/file.pde:123`)
   - **Multiple matches**: Shows all possibilities (e.g., `src/file1.pde:42 or src/file2.pde:156 (line wrapping)`)
   - **No matches**: Falls back to literal (e.g., `output.pde:4464`)

## Important Notes

### File Ordering

Processing uses alphabetical ordering to determine compilation order. Foldcessing extends this to subdirectories, but **the concatenation order may still cause issues** if your code depends on specific ordering. Use Processing's alphabetical naming conventions (e.g., `00_init.pde`, `01_setup.pde`).

### Error Message Console

When double-clicking `foldcessing.exe` with invalid configuration, a MessageBox will display the error. When running from a terminal, errors appear in the console.

## Technical Details

- **Language**: C99
- **Platform**: Windows (Win32 API)
- **Dependencies**: None (single executable)
- **Compiler Compatibility**: TCC, GCC, MSVC

## Contributing

Contributions are welcome! Please feel free to submit issues or pull requests.

## License

This project is licensed under the GNU General Public License v3.0 - see the [LICENSE](LICENSE) file for details.

## Author

Created for the Processing community to enable better code organization in large projects.

---

**Note**: Foldcessing is a third-party tool and is not affiliated with the Processing Foundation.
